/**
 * @license
 * Copyright (C) 2013 Steven Berry (http://www.sberry.me/minimenu)
 * Licensed: MIT (http://opensource.org/licenses/mit-license.php)
 * License Stipulations:
 *     1) Retain this comment block.
 *     2) Send me an email if you use this and have questions/comments!
 * 
 * Steven Berry
 * www.sberry.me
 * steven@sberry.me
 */
!function(t,e){var i,n=t.document,o=0,s={},r=function(t){if(i){var n=s[i];e(n.el).hide(),n.hooks.post(t),n.reset(),i=null}};e(t).bind("click blur",r),e(n).delegate("div.mm-anchor","selectstart",function(t){return t.preventDefault(),!1});var a=function(t,e,i,n){return new a.fn.init(t,e,i,n)};a.fn=a.prototype={init:function(t,i,s,r){var a,h,l,d,c,u,p,v,f,m=!1,g="mm-anchor-"+ ++o,k=[],y=0,b=r.options;d=r.iconSize||20,l=r.iconPadding||4,u=d+2*l,v=e("<div></div>").attr("id",g).addClass("mm-anchor construct"),e(n.body).append(v);for(var C=0;C<b.length;C++)f=e("<div></div>").html(b[C].text),"string"==typeof(h=b[C].event)&&(f[0].event=h,f.addClass("mm-"+h)),"string"==typeof(c=b[C].icon)&&(f.css({"background-image":"url('"+c+"')",height:r.itemHeight||u}).css(b[C].style||{}),m=!0),v.append(f),p=f.outerWidth(),y=p>y?p:y,a=b[C].callback,e.isFunction(a)&&(k.push(h),e(i).delegate(t,h,a));return p=y,m&&(p+=u,v.find("> div").css({"padding-left":u+2,"background-size":d,"background-position":l+"px center"})),v.hide().css("width",p+6).removeClass("construct"),this.id=g,this.el=v[0],this.selector=t,this.context=i,this.events=s,this.itemEvents=k,this.hooks={},this.hooks.pre=this.hooks.post=e.noop,this},hook:function(t,e){var i=s[this.id];return"pre"===t?this.hooks.pre=function(t){t.menu=i,e.call(t.currentTarget,t)}:"post"===t&&(this.hooks.post=function(t){t.menu=i,e.call(i.el,t)}),this},unhook:function(t){return"pre"===t||"post"===t?this.hooks[t]=e.noop:"undefined"==typeof t&&(this.hooks.pre=this.hooks.post=e.noop),this},options:function(t){var i,n;return n=e(this.el).find("> div"),i=e.map(e.trim(t).split(/\s+/g),function(t){return t.length>0?".mm-"+t:void 0}).join(","),i?n.filter(i):n},invalidate:function(t,e){return this.options(t).addClass("mm-invalid").attr("title",e)},reset:function(t){return this.options(t).removeClass("mm-invalid").removeAttr("title")},unload:function(){var t,i,n,o;for(i=this.context,n=this.selector,o=this.itemEvents||[],e(i).undelegate(n,this.events),t=0;t<o.length;t++)e(i).undelegate(n,o[t]);e(this.el).remove(),delete s[this.id]}},e.fn.minimenu=function(t,o,h){var l,d,c;return l=this.selector||n,d=h.invalidClass||"mm-invalid",c=a(t,l,o,h),s[c.id]=c,e(l).delegate(t,o,function(t){t.preventDefault(),r(t),c.hooks.pre(t),c.target=t.currentTarget,e(c.el).css({top:t.pageY-5,left:t.pageX-5}).show(),i=c.id}),e(c.el).delegate("> div","click",function(t){t.stopPropagation(),e(this).hasClass(d)||(r(t),this.event&&e(c.target).trigger(this.event))}),c},a.prototype.init.prototype=a.prototype,t.minimenus=s}(window,jQuery);