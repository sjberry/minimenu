/* Copyright (C) 2013 Steven Berry (http://www.sberry.me/projects/minimenu)
 * Licensed: http://opensource.org/licenses/mit-license.php
 * License Stipulations:
 *     1) Retain this comment block.
 *     2) Send me an email if you use this and have questions/comments!
 * 
 * Steven Berry
 * www.sberry.me
 * steven@sberry.me
 */
(function(k,b,y){var u=k.document,x=0,h={},m,v=function(a){if(m){var c=h[m];b(c.el).hide();c.hooks.post(a);m=null}};b(k).bind("click blur",v);b(u).delegate("div.mm-anchor","selectstart",function(a){a.preventDefault();return!1});var l=function(a,b,d,e){return new l.fn.init(a,b,d,e)};l.fn=l.prototype={init:function(a,c,d,e){var l=!1,f="mm-anchor-"+ ++x,w=[],h=0,p=e.options,g,s,m,k,t,q,r;k=e.iconSize||20;m=e.iconPadding||4;t=k+2*m;q=b("<div></div>").attr("id",f).addClass("mm-anchor construct");b(u.body).append(q);
for(var n=0;n<p.length;n++)r=b("<div></div>").html(p[n].text),"string"===typeof(s=p[n].event)&&(r[0].event=s,r.addClass("mm-"+s)),"string"===typeof(g=p[n].icon)&&(r.css({"background-image":"url('"+g+"')",height:e.itemHeight||t}).css(p[n].style||{}),l=!0),q.append(r),g=r.outerWidth(),h=g>h?g:h,g=p[n].callback,b.isFunction(g)&&(w.push(s),b(c).delegate(a,s,g));g=h;l&&(g+=t,q.find("> div").css({"padding-left":t+2,"background-size":k,"background-position":m+"px center"}));q.hide().css("width",g+6).removeClass("construct");
this.id=f;this.el=q[0];this.selector=a;this.context=c;this.events=d;this.itemEvents=w;this.hooks={};this.hooks.pre=this.hooks.post=b.noop;return this},hook:function(a,b){var d=h[this.id];"pre"===a?this.hooks.pre=function(a){a.currentMenu=d;b.call(a.currentTarget,a)}:"post"===a&&(this.hooks.post=function(a){a.currentMenu=d;b.call(d.el,a)});return this},unhook:function(a){"pre"===a||"post"===a?this.hooks[a]=b.noop:"undefined"===typeof a&&(this.hooks.pre=this.hooks.post=b.noop);return this},options:function(a){var c=
b(this.el).find("> div");return"undefined"===typeof a?c:c.filter(a)},unload:function(){var a=this.context,c=this.selector,d=this.itemEvents||[];b(a).undelegate(c,this.events);for(var e=0;e<d.length;e++)b(a).undelegate(c,d[e]);b(this.el).remove();delete h[this.id]}};b.fn.minimenu=function(a,c,d){var e=this.selector||u,k=d.invalidClass||"mm-invalid",f=l(a,e,c,d);h[f.id]=f;b(e).delegate(a,c,function(a){a.preventDefault();a.stopPropagation();v(a);f.hooks.pre(a);f.target=a.currentTarget;b(f.el).css({top:a.pageY-
5,left:a.pageX-5}).show();m=f.id});b(f.el).delegate("> div","click",function(a){a.stopPropagation();b(this).hasClass(k)||(v(a),this.event&&b(f.target).trigger(this.event))});return f};l.prototype.init.prototype=l.prototype;k.minimenus=h})(window,jQuery);
